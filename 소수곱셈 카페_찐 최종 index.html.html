<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‚˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì¹´í˜ ìŒë£Œ ë ˆì‹œí”¼</title>
<!-- Tone.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ (ì‚¬ìš´ë“œ íš¨ê³¼ìš©) -->
<script src="https://unpkg.com/tone@14.7.58/build/Tone.js"></script> 
<!-- Noto Sans KR í°íŠ¸ ì¶”ê°€ -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Noto Sans KR', sans-serif;
    background: #eef4f9;
    color: #333;
    text-align: center;
    padding: 20px 10px;
    line-height: 1.6;
    min-width: 320px;
  }
  h1 { 
    color: #4c77c9; 
    margin-top: 10px; 
    font-weight: 700;
  }
  h3 {
    color: #1a499b;
    margin-bottom: 15px;
    border-bottom: 2px solid #c9dff7;
    display: inline-block;
    padding-bottom: 5px;
  }

  /* ì´ˆê¸° ì„¤ì • (ì´ë¦„ ì…ë ¥) */
  #initial-setup {
    margin-top: 50px;
    padding: 30px;
    background: #fff;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    max-width: 400px;
    margin: 50px auto 20px;
  }
  #initial-setup input {
    padding: 10px;
    margin: 15px 0 5px 0;
    border: 2px solid #c9dff7;
    border-radius: 8px;
    width: 80%;
    text-align: center;
    font-size: 1.1em;
  }
  #name-error {
    color: #DC143C;
    font-size: 0.9em;
    height: 1.5em; /* ê³µê°„ í™•ë³´ */
    display: none;
  }
  #startBtn {
    background: #4c77c9;
    color: white;
    border: none;
    padding: 10px 20px;
    font-size: 1.1em;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 10px;
  }
  #startBtn:hover { background: #3a62a6; }

  /* ë©”ì¸ ê²Œì„ ì˜ì—­ */
  #main-game { display: none; } 

  /* ì»µ (ìœ ë¦¬ì”) ìŠ¤íƒ€ì¼ - í´ë¦­ íšŸìˆ˜ (ìµœëŒ€ 10) ì‹œê°í™” ìš© */
  #glass {
    width: 200px; 
    height: 300px;
    margin: 50px auto 20px;
    border: 5px solid #aaa;
    border-radius: 10px 10px 50px 50px; /* ë‘¥ê·¼ í•˜ë‹¨ */
    background: transparent;
    position: relative;
    overflow: hidden;
    box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
  }
  /* ì»µ ë‚´ë¶€ì˜ ì•¡ì²´ ì˜ì—­ (ì§„í–‰ ìƒí™© ì‹œê°í™”) */
  #drink-liquid {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 0; /* ì‹œì‘ì€ 0 */
    transition: height 0.5s ease-out, background 0.1s;
    background: #f0f0f0;
  }

  /* ì¬ë£Œ ë²„íŠ¼ */
  .traits {
    display: flex; 
    justify-content: center; 
    flex-wrap: wrap; 
    gap: 15px;
    margin: 30px auto;
    max-width: 900px;
  }
  .trait {
    width: 180px; 
    padding: 15px;
    border-radius: 15px; 
    color: #fff;
    cursor: pointer; 
    font-weight: bold;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.1s, box-shadow 0.1s;
    text-align: left;
  }
  .trait:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
  }
  .trait-name { font-size: 1.1em; margin-bottom: 5px; }
  .trait p { margin: 3px 0; font-size: 0.9em; }
  .trait .value-display { font-size: 1.2em; color: black; text-shadow: 1px 1px 2px rgba(255,255,255,0.3); }

  /* ë°©ìš¸ ìŠ¤íƒ€ì¼ (í¬ê¸° í™•ëŒ€ ë° ê°€ì‹œì„± ê°œì„ ) */
  .drop {
    width: 30px; /* í¬ê¸° í™•ëŒ€ */
    height: 30px; /* í¬ê¸° í™•ëŒ€ */
    border-radius: 50%;
    position: absolute;
    bottom: 0;
    opacity: 1.0; 
    box-shadow: 0 0 8px rgba(255, 255, 255, 0.9), 0 0 2px rgba(0, 0, 0, 0.3); 
    border: 2px solid rgba(255, 255, 255, 0.8); 
    animation: floatDrop 2s ease-in-out infinite alternate, 
               bubble 0.8s ease-out forwards; 
  }
  @keyframes floatDrop {
    from { transform: translateY(0); }
    to { transform: translateY(-10px); }
  }
  @keyframes bubble {
    0% { transform: translateY(300px) scale(0.1); opacity: 0.5; } 
    100% { transform: translateY(0) scale(1.0); opacity: 1.0; }
  }
  
  #createBtn {
    background: #4c77c9; 
    color: white; 
    border: none;
    padding: 12px 25px; 
    font-size: 1.2em;
    border-radius: 8px; 
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    transition: background 0.3s, transform 0.3s;
  }
  #createBtn:hover { 
    background: #3a62a6; 
    transform: translateY(-2px);
  }
  #result { 
    margin-top: 40px; 
    font-size: 1.1em; 
    padding: 20px;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
    max-width: 500px;
    margin: 40px auto;
  }
  .math-expression {
    font-size: 1.3em;
    font-weight: bold;
    color: #4c77c9;
    margin-bottom: 10px;
  }
  #final-drink-name {
    font-size: 2em;
    font-weight: bold;
    color: #DC143C;
    margin: 10px 0 20px;
  }
  /* ìµœì¢… ì»µ ìŠ¤íƒ€ì¼ */
  #final-drink-glass {
    width: 150px;
    height: 250px;
    margin: 20px auto;
    border: 4px solid #aaa;
    border-radius: 10px 10px 40px 40px;
    overflow: hidden;
    position: relative;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    
    /* 10ì¸µ êµ¬ì¡°ë¥¼ ìœ„í•œ ì„¤ì • */
    display: flex; 
    flex-direction: column-reverse; /* ì•„ë˜ë¶€í„° ì±„ì›Œì§€ë„ë¡ */
  }
  /* 10ì¸µ ì¤‘ í•œ ì¸µ ìŠ¤íƒ€ì¼ (100% / 10 = 10%) */
  .drink-layer {
    width: 100%;
    height: 10%; /* 10ì¹¸ìœ¼ë¡œ ë³€ê²½ */
    transition: background-color 0.5s ease;
    border-top: 1px solid rgba(255, 255, 255, 0.5); /* ì¸µ ê²½ê³„ */
  }

  #loading-message {
    font-size: 1.5em;
    font-weight: bold;
    color: #4c77c9;
    margin: 20px 0;
  }
  #description {
    margin-top: 20px;
    font-style: italic;
    color: #555;
    font-weight: normal; /* ë³¼ë“œì²´ ì œê±° ìœ ì§€ */
  }
</style>
</head>
<body>

<h1>ğŸ¥¤ 'ë‚˜'ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì¹´í˜ ìŒë£Œ ë ˆì‹œí”¼</h1>

<div id="initial-setup">
  <h3>ğŸ™Œ ë ˆì‹œí”¼ë¥¼ ë§Œë“¤ê¸° ì „ì— ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!</h3>
  <input type="text" id="userNameInput" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê¹€OO)">
  <div id="name-error"></div>
  <button id="startBtn">ì‹œì‘í•˜ê¸°</button>
</div>


<div id="main-game">
  <h2 id="current-user-title"></h2>
  
  <div id="glass">
    <div id="drink-liquid"></div>
  </div>

  <div class="traits" id="traits">
    <!-- íŠ¹ì„± ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
  </div>
  <button id="createBtn">âœ¨ ë‚˜ë§Œì˜ ìŒë£Œ ë§Œë“¤ê¸°</button>

  <div id="result">
    <!-- ìµœì¢… ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
  </div>
</div>


<script>
// ì¬ë£Œ ë°ì´í„°ë¥¼ ìŒë£Œ ìƒ‰ìƒ/íŠ¹ì„±ì— ë§ê²Œ ì¬ì„¤ì • ë° ê³¼ì¼ ì¶”ê°€
const traitsData = [
  { name: "ì—´ì •", color: "#FF7F50", base: 0.1, value: 0, count: 0, emoji: "ğŸ”¥", fruit: "ë”¸ê¸°" },
  { name: "ê¾¸ì¤€í•¨", color: "#00CED1", base: 0.1, value: 0, count: 0, emoji: "ğŸ’§", fruit: "ë¯¼íŠ¸" }, 
  { name: "ìœ ë¨¸", color: "#FFD700", base: 0.1, value: 0, count: 0, emoji: "ğŸ¤£", fruit: "ë°”ë‚˜ë‚˜" }, 
  { name: "ì¹œì ˆí•¨", color: "#32CD32", base: 0.1, value: 0, count: 0, emoji: "ğŸ˜Š", fruit: "í‚¤ìœ„" }, 
  { name: "ì§‘ì¤‘", color: "#8A2BE2", base: 0.1, value: 0, count: 0, emoji: "ğŸ’¡", fruit: "í¬ë„" }, 
  { name: "ì—ë„ˆì§€", color: "#DC143C", base: 0.1, value: 0, count: 0, emoji: "âš¡", fruit: "ìë‘" }
];

let totalDrops = 0;
const maxDrops = 10; // ìµœëŒ€ í´ë¦­ íšŸìˆ˜ (10íšŒ)
let userName = '';

const glass = document.getElementById('glass');
const drinkLiquid = document.getElementById('drink-liquid');
const traitsDiv = document.getElementById('traits');
const resultDiv = document.getElementById('result');
const mainGame = document.getElementById('main-game');
const initialSetup = document.getElementById('initial-setup');
const userNameInput = document.getElementById('userNameInput');
const startBtn = document.getElementById('startBtn');
const nameError = document.getElementById('name-error');

// --- ì‚¬ìš´ë“œ ì´ˆê¸°í™” (Tone.js ì‚¬ìš©) ---
const dropSynth = new Tone.Synth({
    oscillator: { type: "sine" },
    envelope: { attack: 0.005, decay: 0.1, sustain: 0, release: 0.1 }
}).toDestination();

const doneSynth = new Tone.Synth({
    oscillator: { type: "triangle" },
    envelope: { attack: 0.05, decay: 0.2, sustain: 0, release: 0.5 }
}).toDestination();
// ------------------------------------


// --- ì´ˆê¸° ì„¤ì • ë° ì‹œì‘ ---
startBtn.onclick = () => {
  const name = userNameInput.value.trim();
  if (name.length > 0) {
    if (Tone.context.state !== 'running') {
        Tone.start();
    }
    userName = name;
    initialSetup.style.display = 'none';
    mainGame.style.display = 'block';
    nameError.style.display = 'none';
    document.getElementById('current-user-title').innerText = `${userName}ë‹˜ì˜ ë ˆì‹œí”¼ ì¬ë£Œ íˆ¬ì…í•˜ê¸° (ë‚¨ì€ ë°©ìš¸: ${maxDrops - totalDrops}ê°œ)`;
    renderTraits();
  } else {
    nameError.innerText = 'ì´ë¦„ì„ ì…ë ¥í•´ì•¼ ì‹œì‘í•  ìˆ˜ ìˆì–´ìš”!';
    nameError.style.display = 'block';
  }
};


function renderTraits() {
  traitsDiv.innerHTML = '';
  document.getElementById('current-user-title').innerText = `${userName}ë‹˜ì˜ ë ˆì‹œí”¼ ì¬ë£Œ íˆ¬ì…í•˜ê¸° (ë‚¨ì€ ë°©ìš¸: ${maxDrops - totalDrops}ê°œ)`;

  traitsData.forEach((t, i) => {
    const div = document.createElement('div');
    div.className = 'trait';
    div.style.backgroundColor = t.color;
    // ì†Œìˆ˜ì˜ ê³±ì…ˆ êµìœ¡ì„ ìœ„í•´ ìˆ˜ì‹ì´ ê°•ì¡°ë˜ë„ë¡ êµ¬ì¡° ë³€ê²½
    div.innerHTML = `
      <div class="trait-name">${t.emoji} ${t.name}</div>
      <p>ê¸°ë³¸ê°’: ${t.base.toFixed(1)}</p> 
      <p>í´ë¦­ íšŸìˆ˜(ë°©ìš¸): ${t.count}ë²ˆ</p>
      <p>ì´ ì–‘: 
        <span class="value-display">${t.base.toFixed(1)} Ã— ${t.count} = ${(t.base * t.count).toFixed(1)}</span>
      </p>
    `;
    div.onclick = () => addDrop(i);
    // ìµœëŒ€ íšŸìˆ˜ ë„ë‹¬ ì‹œ í´ë¦­ ë¹„í™œì„±í™”
    if (totalDrops >= maxDrops) {
      div.style.opacity = '0.7';
      div.onclick = null;
    }
    traitsDiv.appendChild(div);
  });
}

function addDrop(index) {
  if (totalDrops >= maxDrops) {
    renderTraits(); 
    return;
  }

  const t = traitsData[index];
  
  // 1. ë°ì´í„° ì—…ë°ì´íŠ¸
  totalDrops++;
  t.count++;
  t.value = t.base * t.count;

  // 2. ë°©ìš¸ ì• ë‹ˆë©”ì´ì…˜
  const drop = document.createElement('div');
  drop.className = 'drop';
  drop.style.backgroundColor = t.color;
  // ë°©ìš¸ ìœ„ì¹˜ë¥¼ ìœ ë¦¬ì” ë‚´ë¶€ì—ì„œ ëœë¤í•˜ê²Œ ì„¤ì • (200px - 30px = 170)
  const randomX = Math.random() * (170); 
  drop.style.left = randomX + 'px';
  glass.appendChild(drop);

  // 3. ì•¡ì²´ ë†’ì´ ì¦ê°€ (í´ë¦­ íšŸìˆ˜ ê¸°ë°˜, ìµœëŒ€ 10íšŒ)
  drinkLiquid.style.height = (totalDrops / maxDrops) * 100 + '%';
  drinkLiquid.style.backgroundColor = t.color; // ë§ˆì§€ë§‰ ë°©ìš¸ ìƒ‰ìƒìœ¼ë¡œ ì„ì‹œ í‘œì‹œ

  // 4. ì‚¬ìš´ë“œ ì¬ìƒ
  dropSynth.triggerAttackRelease("C4", "8n");

  renderTraits();
}

document.getElementById('createBtn').onclick = () => {
  if (totalDrops === 0) {
    resultDiv.style.display = 'block';
    resultDiv.innerHTML = '<p style="color:red; font-weight:bold;">ì•„ë¬´ ì¬ë£Œë„ ë„£ì§€ ì•Šì•˜ì–´ìš”! ë ˆì‹œí”¼ë¥¼ ì™„ì„±í•´ì£¼ì„¸ìš”.</p>';
    return;
  }

  // 1. ë¡œë”© ë©”ì‹œì§€ í‘œì‹œ
  resultDiv.style.display = 'block';
  resultDiv.innerHTML = '<div id="loading-message">â˜• ìŒë£Œë¥¼ ì œì¡°ì¤‘ì…ë‹ˆë‹¤...</div>';
  
  // 2. 0.5ì´ˆ í›„ ìµœì¢… ê²°ê³¼ í‘œì‹œ
  setTimeout(() => {
    
    // í˜„ì¬ ë°ì´í„° ë°°ì—´ ë³µì‚¬ ë° ì´ ì–‘ ê³„ì‚°
    const dropsArray = traitsData.map(t => ({ 
      name: t.name, 
      color: t.color, 
      count: t.count,
      base: t.base, 
      value: t.value,
      fruit: t.fruit // ê³¼ì¼ ì´ë¦„ í¬í•¨
    }));
    const totalValue = dropsArray.reduce((sum, d) => sum + d.value, 0);

    // 3. ìŒë£Œ ì´ë¦„ ë° ì„¤ëª… ê²°ì •
    const topTraits = dropsArray
        .filter(t => t.value > 0) 
        .sort((a, b) => b.value - a.value);

    let drinkName = `${userName} ì£¼ìŠ¤`;
    let description = "";
    
    if (topTraits.length > 0) {
      const top1Trait = topTraits[0];
      drinkName = `${userName}ì˜ ${top1Trait.fruit} ì£¼ìŠ¤`; // ê³¼ì¼ ì´ë¦„ ì‚¬ìš©
      
      if (topTraits.length >= 2 && topTraits[1].value > 0 && top1Trait.name !== topTraits[1].name) {
        const top2Name = topTraits[1].name;
        // ê°„ê²°í•œ ì„¤ëª… ë¬¸êµ¬
        description = `${top1Trait.name} ì™€ ${top2Name} ë¥¼ ê°€ì§„ ë‹¹ì‹ !`;
      } else {
        // ê°„ê²°í•œ ì„¤ëª… ë¬¸êµ¬
        description = `ë‹¹ì‹ ì€ ${top1Trait.name} ì˜ íŠ¹ë³„í•œ ì—ë„ˆì§€ë¥¼ ê°€ì§„ ë¶„ì´êµ°ìš”!`;
      }
    } else {
      description = "ì•„ì§ ì¬ë£Œê°€ ì—†ì–´ ë§›ì„ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¬ë£Œë¥¼ ë„£ì–´ì£¼ì„¸ìš”.";
    }


    // 4. 10ì¸µ ë ˆì´ì–´ HTML ìƒì„± (Value ê¸°ë°˜)
    // maxLayersë¥¼ 10ìœ¼ë¡œ ë³€ê²½í•˜ê³  CSS heightë„ 10%ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.
    const maxLayers = 10; 
    
    let layersHTML = '';
    const layerColors = [];

    // 1. ê° ì¬ë£Œë³„ë¡œ ëª‡ ì¹¸ì„ ì±„ì›Œì•¼ í•˜ëŠ”ì§€ ê³„ì‚°í•˜ê³  ìƒ‰ìƒ ë°°ì—´ì— ì¶”ê°€
    dropsArray.forEach(t => {
        // t.valueëŠ” 0.1 ë‹¨ìœ„ì˜ ê°’ì´ë¯€ë¡œ 10ì„ ê³±í•˜ë©´ ì¸µì˜ ê°œìˆ˜(ì •ìˆ˜)ê°€ ë¨.
        const numLayers = Math.round(t.value * 10); 
        for (let i = 0; i < numLayers; i++) {
            // ì•„ë˜ë¶€í„° ì±„ì›Œì§€ë¯€ë¡œ ìˆœì„œëŒ€ë¡œ ìƒ‰ìƒ ì¶”ê°€
            layerColors.push(t.color); 
        }
    });

    // 2. ë‚˜ë¨¸ì§€ ë¹ˆ ì¹¸ (ì±„ì›Œì§€ì§€ ì•Šì€ ë¶€ë¶„)ì€ íˆ¬ëª…í•˜ê²Œ ì²˜ë¦¬
    while(layerColors.length < maxLayers) {
        layerColors.push('transparent');
    }
    
    // 3. HTML ìƒì„± (10ì¸µ)
    for (let i = 0; i < maxLayers; i++) {
        const color = layerColors[i]; 
        // height: 10%ëŠ” CSSì— ì •ì˜ë˜ì–´ ìˆìŒ
        layersHTML += `<div class="drink-layer" style="background-color: ${color};"></div>`;
    }

    // 5. ìµœì¢… ê²°ê³¼ í‘œì‹œ HTML
    const statsList = dropsArray.map(t => 
      `<li>${t.name}: ${t.base.toFixed(1)} (ê¸°ë³¸ê°’) Ã— ${t.count} (íšŸìˆ˜) = ${t.value.toFixed(1)} (ì´ ì–‘)</li>`
    ).join('');

    resultDiv.innerHTML = `
      <h3>âœ¨ ì™„ì„±ëœ ë ˆì‹œí”¼ âœ¨</h3>
      <div id="final-drink-name">${drinkName}</div>
      
      <!-- ìµœì¢… ìŒë£Œ ì” - 10ê°œ ì¸µìœ¼ë¡œ êµ¬ì„± -->
      <div id="final-drink-glass">
        ${layersHTML}
      </div>
      
      <p class="math-expression">ì´ ì–‘ (Total Value): ${totalValue.toFixed(1)}</p>
      
      <div id="description" style="font-style: normal; margin-top: 10px; font-weight: normal;">${description}</div>
      
      <div style="text-align: left; margin: 20px auto 0; max-width: 300px; font-size:0.9em;">
        <h4>ğŸ¹ ì¬ë£Œ ìƒì„¸ ê³„ì‚°</h4>
        <ul style="list-style: none; padding-left: 0;">
          ${statsList}
        </ul>
      </div>
    `;
    
    // ì™„ë£Œ ì‚¬ìš´ë“œ ì¬ìƒ
    const now = Tone.now();
    doneSynth.triggerAttackRelease("C4", "8n", now);
    doneSynth.triggerAttackRelease("E4", "8n", now + 0.1);
    doneSynth.triggerAttackRelease("G4", "4n", now + 0.2); 

  }, 500); // 0.5ì´ˆ ë”œë ˆì´
};

renderTraits();
</script>

</body>
</html>
